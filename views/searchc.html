<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Title</title>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-+0n0xVW2eSR5OomGNYDnhzAbDsOXxcvSN1TPprVMTNDbiYZCxYbOOl7+AMvyTG2x" crossorigin="anonymous">
  <link rel="stylesheet" href="../css/searchc.css">
</head>
<body>
<nav class="navbar navbar-expand-lg navbar-light">
<li class="nav-item">
  <a class="nav-link" href="addcompany.html">NEW COMPANY</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="invoice1.html">NEW INVOICE</a>
</li>
  <li class="nav-item">
    <a class="nav-link active" href="index.html">VIEW INVOICE</a>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="companylist.html">VIEW COMPANY</a>
  </li>
</nav>
<br><br>


<form class="d-flex" action="searchc.html">
  <input class="form-control me-2" type="search" name="search" id="search" placeholder="Search" aria-label="Search">
  <button class="btn btn-outline-success" name="submit" value="submit" onclick="findvalue()">Submit</button>
</form>


<nav aria-label="Page navigation example">
  <ul id="page" class="pagination">


  </ul>
</nav>
<div id="result" style="margin-top: 50px; border: 2px solid black">
  <table class="table" id="myTable">
    <thead>
    <tr>
      <th scope="col">S No.</th>
      <th scope="col">Invoice</th>
      <th scope="col">Company</th>
      <th scope="col">View</th>
      <th scope="col">Edit</th>
      <th scope="col">Delete</th>
    </tr>
    </thead>
    <tbody id="abc">
    </tbody>
  </table>
</div>
<script>
  var loc=window.location.href
  var name=((loc.split('&')[0]).split('=')[1]).toUpperCase()
  console.log(name)

  console.log("http://localhost/rest/api/searchc?cname="+`${name}`)

  function ffetch(){
    fetch("http://localhost/api/searchinvoice?cname="+`"${name}"`).then(res=>res.json()).then(data=>{
    tbody = document.getElementById("abc")
      op = "<tr>"
        data.data.forEach(function (data, index) {
          console.log(data)
          op+=`<th scope="row">${index+1}</th>`
          op+=`<td>InvoiceItem${data['iid']}</td>`
          op+=`<td>${data['name']}</td>`
          op+=`<td><a class="fa fa-eye" href="preview.html#${data['iid']}" style="color: black;" ></a> </td>`

          op+=`<td><a class="fa fa-edit" href="update.html#${data['iid']}"  style="color: black;" ></a> </td>`
          op+=`<td><a class="fa fa-trash" onclick="del(${data['iid']})" style="color: black;" ></a> </td>`
          op += "<tr>";
          tbody.innerHTML = op;
        })
      })
  }
  ffetch()

  page=document.getElementById('page')
  var totallength=localStorage.getItem("total length1")
  console.log("tl",totallength)
  numofPages=Math.ceil(totallength/10)
  console.log("num",numofPages)
  op=''
  for (i=1; i<=numofPages;i++){
    op+=`<li class="page-item"><a class="page-link" id="${i}" onclick="newpage(${i})">${i}</a></li>`
  }
  page.innerHTML=op
  console.log('op',op)

  function newpage(id){
    iid=(id-1)*10
    var storedId = JSON.parse(localStorage.getItem("allIDs1"));
    console.log("storedid",storedId)
    fetch("http://localhost/api/invoicepages?offset="+storedId[iid]+"&limit=10").then(res=>res.json()).then(data=>{
      tbody = document.getElementById("abc")
      localStorage.setItem("total length1",data.data.length)
      op = "<tr>"
      data.data.forEach(function (data, index) {
        console.log(data)
        op+=`<th scope="row">${index+1}</th>`
        op+=`<td>InvoiceItem${data['id']}</td>`
        op+=`<td>${data['cname']}</td>`
        op+=`<td><a class="fa fa-eye" href="preview.html#${data['id']}" style="color: black;" ></a> </td>`
        op+=`<td><a class="fa fa-edit" href="invoice1.html.html#${data['id']}" style="color: black;" ></a> </td>`
        op+=`<td><a class="fa fa-trash" onclick="del(${data['id']})" style="color: black;" ></a> </td>`
        op += "<tr>";
        tbody.innerHTML = op;
      })
    })}

function aaa(id){
    localStorage.setItem("invoice_id",id)
}

function edit(id){
    localStorage.setItem("invoice_id",id)
}

  function del(id){
    var item_id=id
    var ans=`Your information will be removed from database.`;
    var r=confirm(ans)
    mybody={"id":item_id}
    if (r){
      fetch('http://localhost/api/deleteinvoice', {
        method: 'DELETE',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify(mybody)
      }).then(()=>{

                ffetch()
              }
      ).
      catch(err=>console.log(err));
    }
  }

</script>
</body>
</html>