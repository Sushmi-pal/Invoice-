<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Invoice</title>

  <link rel="stylesheet" href="../css/addcomp.css">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.12.1/css/all.css" crossorigin="anonymous">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-+0n0xVW2eSR5OomGNYDnhzAbDsOXxcvSN1TPprVMTNDbiYZCxYbOOl7+AMvyTG2x" crossorigin="anonymous">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-validate/1.19.3/jquery.validate.min.js"></script>

<!--  <script type="text/javascript" src="../js/addcompany.js"></script>-->
</head>
<body>
<nav class="navbar navbar-expand-lg navbar-light">
  <li class="nav-item">
    <a class="nav-link active" href="addcompany.html">NEW COMPANY</a>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="invoice1.html">NEW INVOICE</a>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="index.html">VIEW INVOICE</a>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="companylist.html">VIEW COMPANY</a>
  </li>
</nav>

<div class="main">
  <div class="container" style="margin-top: 70px; border-radius: 35px; width: 35%;">
    <form id="addPostForm" action="invoice1.html" method="post">
      <div id="cpage" style="padding-bottom: 3%;">
        <h1>Company Info Page</h1>
      </div>

      <label for="cname">Company Name</label><br>
      <input type="text" id="cname" name="cname" class="cname" size="50" ><br>
      <span id="spanname" class="error"></span> <br>

      <label for="address">Address</label><br>
      <input type="text" id="address" name="address" class="address" size="50"><br>
      <span id="spanaddress" class="error"></span> <br>

      <label for="city">City</label><br>
      <input type="text" id="city" name="city" class="city" size="50"><br>
      <span id="spancity" class="error"></span> <br>

      <label for="email">Email</label><br>
      <input type="text" id="email" name="email" class="email" size="50"><br>
      <span id="spanemail" class="error"></span> <br>

      <label for="phone">Contact num</label><br>
      <input type="text" id="phone" name="phone" class="phone" size="50"><br>
      <span id="spancontact" class="error"></span><br>


      <button class="btn btn-outline-info" type="submit" id="submit" name="submit">Submit</button>
    </form>

  </div>
</div>
<script>
  $("#cname"). on ("keyup paste",function (){
    if (spanname.innerText=='Company name is empty'){
      spanname.innerText=''
    }
  })

  $("#address").on ("keyup paste", function (){
    if (spanaddress.innerText=='Address field is empty'){
      spanaddress.innerText=''
    }
  })

  $("#city").on ("keyup paste",function (){
    if (spancity.innerText=='City name is empty'){
      spancity.innerText=''
    }
  })

  $("#phone").on ("keyup paste",function (){
    if (spancontact.innerText=='Contact number field is empty'){
      spancontact.innerText=''
    }
  })

  $("#email").on("keyup paste", function (){
    if (spanemail.innerText=='Email field is empty'){
      spanemail.innerText=''
    }
  })




  $(document).ready(function (){
    $("#addPostForm").validate({
      rules:{
        cname:{
          required:true,
          minlength:3
        },
        address:{
          required: true,
          minlength:2
        },
        email:{
          email:true,
          required:true
        },
        city:{
          required:true
        },
        phone:{
          required:true,
          minlength:10
        }
      }
    })
  })


  function vemail(){
    var email=document.getElementById('email')
    fetch("http://localhost/api/emailvalidate", {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({"email":email.value})
    }).then(res => res.json()).then(data => {
      document.getElementById('spanemail').innerText=data['Message']})
    if (document.getElementById('spanemail').innerText=="Email address already exists"){
      return false
    }
    else{
      return true
    }
  }

  $("body").click(function (){
    vemail()
  })

  function vaddress(){
    if (address.value==''){
      document.getElementById('spanaddress').innerText="Address field is empty"
      return false
    }
    if (address.value.length<2){
      return false
    }
    console.log('address',address.value)
    return true
  }

  function vcname(){
    if (cname.value==''){
      document.getElementById('spanname').innerText="Company name is empty"
      return false
    }
    document.getElementById('spanname').innerText=''
    return true
  }

  function vcity(){
    if (city.value==''){
      document.getElementById('spancity').innerText="City name is empty"
      return false
    }
    document.getElementById('spancity').innerText=''
    return true
  }

  function vphone(){
    if (phone.value==''){
      document.getElementById('spancontact').innerText="Contact number field is empty"
      return false
    }
    document.getElementById('spancontact').innerText=''
    return true
  }

  function emailempty(){
    if (document.getElementById('email').value==''){
      document.getElementById('spanemail').innerText="Email field is empty"
      return false
    }
    else{
      return true
    }

  }



  document.getElementById('addPostForm').addEventListener('submit',function (e) {
    e.preventDefault()
    var name = document.getElementById('cname')
    var address = document.getElementById('address')
    var email = document.getElementById('email')
    var city = document.getElementById('city')
    var phone = document.getElementById('phone')

    const myPost = {
      email: email.value,
      name: name.value,
      address: address.value,
      contact: phone.value,
      city: city.value
    }

    vcname()
    vaddress()
    emailempty()
    vcity()
    vphone()
    console.log(emailempty())
    console.log("vemail",vemail())


    if (vaddress() && vcname() && emailempty() && vcity() && vphone() && vemail()) {
      fetch("http://localhost/api/companycreate", {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify(myPost)
      }).then(res => res.json()).then(data => {
        console.log(data)
        alert("Your information has been saved")
        window.location.href="invoice1.html"

      })}
  })

  $("#email"). on ("keyup keypress paste",function (){
    vemail()
  })

</script>
</body>
</html>